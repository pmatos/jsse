# JSSE â€” Master Implementation Plan

A from-scratch JavaScript engine in Rust, fully spec-compliant with ECMA-262.

**Total test262 scenarios:** 91,986 (48,002 files, dual strict/non-strict per spec)
**Current pass rate:** 89,169 / 91,986 (96.94%)
**intl402/Temporal pass rate:** 3,838 / 3,838 (100.00%)

---

## Phased Implementation Roadmap

The engine is broken into 10 phases, ordered by dependency. Each phase has a detailed sub-plan in `plan/`.

| Phase | Name | Spec Sections | Status | Detail |
|-------|------|---------------|--------|--------|
| 1 | [Project Scaffolding & Infrastructure](plan/phase-01-infrastructure.md) | â€” | âœ… Complete | Rust project, CLI, test harness, CI |
| 2 | [Types & Values](plan/phase-02-types.md) | Â§6 | âœ… ~95% | Language types, spec types, type conversions |
| 3 | [Lexer](plan/phase-03-lexer.md) | Â§12 | âœ… Complete | Lexical grammar, tokens, Unicode |
| 4 | [Parser (AST)](plan/phase-04-parser.md) | Â§13â€“16 | âœ… Complete | Expressions, statements, functions, modules |
| 5 | [Runtime Core](plan/phase-05-runtime.md) | Â§6â€“10 | ðŸŸ¡ ~30% | Environments, execution contexts, objects |
| 6 | [Evaluation â€” Expressions & Statements](plan/phase-06-evaluation.md) | Â§13â€“14 | ðŸŸ¡ ~60% | Most operators/statements work |
| 7 | [Functions & Classes](plan/phase-07-functions-classes.md) | Â§15 | ðŸŸ¡ ~70% | Functions, classes, generators, async/await work |
| 8 | [Modules & Scripts](plan/phase-08-modules.md) | Â§16 | âœ… ~90% | import/export, dynamic import(), import.meta, TLA, cyclic deps |
| 9 | [Built-in Objects](plan/phase-09-builtins.md) | Â§19â€“28 | ðŸŸ¡ ~40% | Object, Array, String, Math, JSON (105/165), URI encode/decode work |
| 10 | [Advanced Features](plan/phase-10-advanced.md) | Â§17,25â€“27,B | ðŸŸ¡ ~20% | Error handling, memory model, Proxy, Reflect, Annex B |

---

## Current Built-in Status

Scenario counts (dual strict/non-strict per spec INTERPRETING.md).

| Built-in | Pass Rate | Scenarios |
|----------|-----------|-----------|
| Reflect | 100% | 306/306 |
| Map | 100% | 403/405 |
| Symbol | 100% | 184/184 |
| WeakRef | 100% | 58/58 |
| FinalizationRegistry | 100% | 94/94 |
| Temporal | 99% | 8,898/8,964 |
| Number | 99.7% | 668/670 |
| annexB | 99% | 1,362/1,377 |
| RegExp | 98% | 3,682/3,756 |
| DisposableStack | 99% | 180/182 |
| String | 97% | 2,362/2,427 |
| DataView | 97% | 1,090/1,122 |
| Set | 97% | 742/764 |
| Math | 100% | 654/654 |
| Object | 97% | 6,565/6,802 |
| Promise | 96% | 1,224/1,272 |
| Array | 96% | 5,874/6,111 |
| Iterator | 96% | 980/1,020 |
| TypedArray | 96% | 2,732/2,860 |
| Date | 95% | 1,130/1,188 |
| Function | 95% | 847/893 |
| Proxy | 89% | 540/607 |
| TypedArrayConstructors | 89% | 1,280/1,442 |

---

## Current Blockers (Highest Impact)

These features block significant numbers of tests:

1. ~~**`arguments` object**~~ â€” âœ… Done (82/203, 40.39%). Mapped arguments + Symbol.iterator implemented.
2. ~~**Garbage collection**~~ â€” âœ… Done. Mark-and-sweep GC with free-list reuse (148 MB â†’ 11 MB on 100k object alloc).
3. ~~**Generator `yield` evaluation**~~ â€” âœ… Done (965 new passes, 33.79% overall). Replay-based yield with next/return/throw. Remaining: yield* delegation, throw resumption, GeneratorFunction constructor.
4. **Iterator protocol** â€” Breaks `for...of`, spread on non-arrays, many built-in methods.
4. ~~**Promise**~~ â€” âœ… Done (190/639, 30%). Constructor, then/catch/finally, resolve/reject/all/allSettled/race/any. Async/await supported.
5. ~~**Map/Set**~~ â€” âœ… Done (Map: 103/204, Set: 261/383). Remaining failures: native fn `.length` properties, Proxy/Reflect/Symbol.species deps.
6. ~~**Date**~~ â€” âœ… Done (305/594, 51%). Constructor, static methods (now/parse/UTC), getters, setters, string formatting, Symbol.toPrimitive. Remaining failures: native fn `.length`/`.name`/prop-desc, Proxy/Reflect.construct, edge-case string parsing.

---

## Recommended Next Tasks (Priority Order)

1. ~~**Complete `arguments` object (mapped arguments)**~~ â€” âœ… Done
2. ~~**Garbage collection**~~ â€” âœ… Done
3. ~~**Complete Iterator built-in**~~ â€” âœ… Done (138/510, 27%). Constructor, helpers (toArray/forEach/reduce/some/every/find/map/filter/take/drop/flatMap), Iterator.from, Iterator.concat. Remaining failures need generators.
3. ~~**Implement Map and Set**~~ â€” âœ… Done (364 new passes)
4. ~~**Implement Date**~~ â€” âœ… Done (305/594, 51%, 406 new passes overall)
5. ~~**Generator `yield` evaluation**~~ â€” âœ… Done (965 new passes)
6. ~~**Proxy and Reflect**~~ â€” âœ… Done (Reflect: 54/153, Proxy: 120/311, 140 net new passes). All 13 traps wired, Proxy.revocable implemented. Remaining: invariant enforcement, Symbol property keys.
7. ~~**Native function `.length` and Constructor `.prototype` exposure**~~ â€” âœ… Done (375 new passes, 50 regressions, net +325). All 210+ native functions now report correct arity via `.length`. Array.prototype and String.prototype accessible via constructors.
8. ~~**Private class elements runtime**~~ â€” âœ… Done (87 new passes, 1 regression). Private methods, private getters/setters, static private methods/accessors, `#x in obj` brand checks.
9. ~~**WeakMap and WeakSet**~~ â€” âœ… Done (WeakMap: 72/141, WeakSet: 50/85, 129 new passes overall). Constructor with iterable, get/set/has/delete methods. Weak GC semantics implemented (ephemeron fixpoint, post-sweep cleanup).
10. ~~**Symbol built-in**~~ â€” âœ… Done (26/94, 28%, 43 new passes overall). Symbol.prototype (toString, valueOf, description, @@toPrimitive, @@toStringTag), Symbol.for/keyFor registry, new Symbol() TypeError, symbol equality, primitive property access.
11. ~~**RegExp well-known Symbol methods + lastIndex + String dispatch**~~ â€” âœ… Done (165 new passes, 38.02% â†’ 38.42%). RegExp.prototype exec/test with lastIndex/global/sticky/captures. @@match, @@search, @@replace, @@split, @@matchAll on RegExp.prototype. String.prototype match/replace/replaceAll/search/split/matchAll dispatch through Symbol methods. RegExpStringIterator for matchAll. Follow-up: flags getter, ToString coercion fix, hasIndices flag (+37 passes, 54.68% â†’ 54.76%). RegExp: 941/1,879 (50.08%).
12. ~~**Class public instance fields, method descriptors, static blocks**~~ â€” âœ… Done (236 new passes, 39.21% â†’ 39.78%). Public instance fields stored on constructor and initialized at construction time. Class method descriptors set to enumerable:false per spec. Static blocks executed with `this` bound to constructor.
13. ~~**Array built-in spec compliance**~~ â€” âœ… Done (926 new passes, 42.63% â†’ 44.58%). All Array.prototype methods rewritten with ToObject(this), LengthOfArrayLike, IsCallable validation, thisArg support, and property-based access for array-like objects. Array: 736/2,989 â†’ 2,050/3,079 (67%).
14. ~~**`for await...of` and async iteration**~~ â€” âœ… Done (1,014 new passes, 44.82% â†’ 46.89%). Parse `for await (... of ...)`, Symbol.asyncIterator, async-from-sync iterator wrapper, await in for-of loop body. for-await-of: 567/1,234 (46%). Test harness fix: auto-include doneprintHandle.js for async tests.
15. ~~**Async generators (`async function*`)**~~ â€” âœ… Done (2,332 new passes, 46.89% â†’ 51.80%). AsyncGenerator iterator state, %AsyncIteratorPrototype% with [Symbol.asyncIterator], %AsyncGeneratorPrototype% with next/return/throw returning promises, await yielded values, AsyncGeneratorFunction.prototype chain, yield* with async iterators, rejected promises for type errors, nested yield expression fix. async-generator statements: 188/301 (62%), expressions: 399/623 (64%), for-await-of: 1,064/1,234 (86%), AsyncGeneratorPrototype: 29/48 (60%).
16. ~~**`with` statement**~~ â€” âœ… Done (19 new passes, 51.80% â†’ 51.84%). Object environment records with `with_object` field on Environment. Property lookup/assignment through with-scope object. `@@unscopables` support (eagerly resolved). Known limitations: Proxy `has` trap not invoked in with-scope, lazy @@unscopables getter evaluation not supported. with statements: 41/181 (23%).
17. ~~**not-a-constructor enforcement**~~ â€” âœ… Done (290 new passes, 51.84% â†’ 52.45%). Added `is_constructor` flag to `JsFunction::Native`, only constructors get `.prototype` property. `eval_new()` throws TypeError for non-constructors. Built-in constructors (Object, Array, Error variants, String, Number, Boolean, Function, RegExp, Date, Map, Set, WeakMap, WeakSet, Promise, Proxy, ArrayBuffer, DataView, TypedArrays) marked as constructors; all other native functions default to non-constructor.
18. ~~**String.prototype wiring fix**~~ â€” âœ… Done (445 new passes, 5 regressions, 52.45% â†’ 53.38%). Reordered String constructor registration before `setup_string_prototype()` so prototype methods are wired correctly. String: 462/1,215 (38%) â†’ 863/1,215 (71%).
19. ~~**Iterator protocol completion**~~ â€” âœ… Done (70 new passes, 53.38% â†’ 53.53%). Symbol.dispose on %IteratorPrototype%, Iterator.zip and Iterator.zipKeyed with shortest/longest/strict modes, argument validation closes iterator on failure, take/drop edge case fixes, generator return/throw borrow fix. Iterator: 138/510 (27%) â†’ 290/510 (57%).

20. ~~**Error & NativeError built-in fixes**~~ â€” âœ… Done (58 new passes, 54.83% â†’ 54.95%). Per-type NativeError prototypes inheriting from Error.prototype with `name`, `message`, `constructor`. Error.prototype properties set non-enumerable. Constructor arities fixed to 1. `cause` option support. Message ToString coercion. Error.isError() static method. Error: 32/53 (60%), NativeErrors: 62/92 (67%).
21. ~~**`instanceof` and `Function.prototype[@@hasInstance]`**~~ â€” âœ… Done (7 new passes, 54.95%). Spec-compliant `instanceof` (Â§13.10.2): checks `Symbol.hasInstance` before prototype chain walk, throws TypeError for non-objects. `OrdinaryHasInstance` extracted as reusable helper. `Function.prototype[@@hasInstance]` added (non-writable, non-enumerable, non-configurable). instanceof: 25/43 â†’ 28/43 (65%), Function.prototype[Symbol.hasInstance]: 1/11 â†’ 5/11 (45%).
22. ~~**Function name inference (SetFunctionName)**~~ â€” âœ… Done (628 new passes, 54.95% â†’ 56.25%). Anonymous functions get `.name` set from binding context: variable declarations, assignments, object literal properties, destructuring defaults, get/set accessors (prefixed with "get "/"set ").
23. ~~**Generator method syntax in object literals**~~ â€” âœ… Done (160 new passes, 56.25% â†’ 56.54%). Parse `{ *method() { yield ... } }` in object literals. Unblocks gen-meth-* destructuring tests and generator method-definition tests.
25. ~~**Object destructuring RequireObjectCoercible + ToObject + getter invocation**~~ â€” âœ… Done (141 new passes, 60.83% â†’ 61.06%). Object destructuring now calls `to_object()` (throws TypeError for null/undefined, wraps primitives). Property access during destructuring uses `get_object_property()` to invoke getters and Proxy traps.
26. ~~**Update expressions for member expressions + ToNumeric**~~ â€” âœ… Done (50 new passes). `obj.x++`, `obj[i]++`, `--obj.prop` now work. Update expressions use `to_primitive(number)` for valueOf coercion on objects.
27. ~~**Math[@@toStringTag] + prop-desc fixes**~~ â€” âœ… Done (25 new passes). Math methods now non-enumerable. Math: 275/327 (84%) â†’ 300/327 (92%).
28. ~~**WeakRef + FinalizationRegistry**~~ â€” âœ… Done (56 new passes). WeakRef constructor + deref(). FinalizationRegistry constructor + register/unregister. WeakRef: 22/29 (76%), FinalizationRegistry: 34/47 (72%).
24. ~~**AggregateError + Promise.try/withResolvers + Proxy invariants**~~ â€” âœ… Done (75 new passes, 58.30% â†’ 58.46%). AggregateError constructor with proper prototype chain. Promise.try and Promise.withResolvers static methods. Proxy invariant enforcement for get/set/has/deleteProperty/defineProperty/getOwnPropertyDescriptor/ownKeys/getPrototypeOf/setPrototypeOf/isExtensible/preventExtensions traps. Proxy trap delegation added to Reflect methods. AggregateError: 14/25 (56%), Proxy: 163/310 (53%), Reflect: 124/153 (81%).
29. ~~**Symbol property key uniqueness**~~ â€” âœ… Done (51 new passes, 62.22% â†’ 62.28%). Symbols with same description were treated as identical property keys. Added id-based property key format for user-created symbols. Updated all built-in functions (Object.hasOwn, defineProperty, getOwnPropertyDescriptor, Reflect methods, etc.) to use `to_property_key_string` for symbol-aware key conversion.
30. ~~**Function parameter error propagation**~~ â€” âœ… Done (371 new passes, 61.44% â†’ 62.22%). Destructuring errors in function parameter binding were silently swallowed by `let _ =`. Now propagated as throws for sync functions and promise rejections for async functions.
31. ~~**@@toPrimitive support + unary operator ToPrimitive**~~ â€” âœ… Done (45 new passes, 62.28% â†’ 62.38%). `to_primitive` now checks `Symbol.toPrimitive` before falling back to valueOf/toString per Â§7.1.1. Unary +/- operators now call `to_number_coerce` for objects instead of raw `to_number`. 1 Date regression (year-zero parsing).
32. ~~**Prototype constructor properties**~~ â€” âœ… Done (119 new passes, 62.38% â†’ 62.62%). Added `constructor` property to Array.prototype, Number.prototype, Boolean.prototype, RegExp.prototype pointing to their respective constructors. 1 Array.from regression (thisArg constructor).
33. ~~**Generator state machine refactor**~~ â€” âœ… Done (694 new passes, 62.70% â†’ 64.16%). Replaced replay-from-start generator execution with persistent environment. Parameters bound once at creation, local variables persist between yields. Added `GeneratorExecutionState` enum (SuspendedStart, SuspendedYield, Executing, Completed). Generator statements: 225/266 (85%), expressions: 233/290 (80%), GeneratorPrototype: 38/61 (62%).
34. ~~**ES Modules**~~ â€” âœ… Done (684 new passes, 64.16% â†’ 64.52%). Full ES module support: import/export declarations, dynamic import(), import.meta, top-level await, module namespace objects with live bindings, circular dependency detection, duplicate export detection, re-export live binding resolution. module-code: 518/737 (70%), import: 120/162 (74%), dynamic-import: ~60%.
35. ~~**TypedArray.prototype.with()**~~ â€” âœ… Done (13 new passes, 64.52% â†’ 64.54%). ES2023 immutable update method that creates a copy with a single element replaced. Proper coercion order (index then value), BigInt TypedArray support, valueOf error propagation. TypedArray: 786/1,438 (55%).
36. ~~**Array.prototype.toLocaleString + Object.prototype.toLocaleString + TypedArray.prototype.toLocaleString**~~ â€” âœ… Done (48 new passes, 64.54% â†’ 64.64%). Implemented per ECMA-262 Â§23.1.3.32: ToObject(this), LengthOfArrayLike, comma separator, skip undefined/null elements, Invoke toLocaleString on others with no arguments. Added Object.prototype.toLocaleString as base (calls this.toString). Added TypedArray.prototype.toLocaleString with ValidateTypedArray checks. Array/toLocaleString: 8/12 (67%), Object/toLocaleString: 11/12 (92%), TypedArray/toLocaleString: passing.

42. ~~**Conformance batch 5: Property descriptors, strict mode, String exotic**~~ â€” âœ… Done (133 new passes, 67.89% â†’ 68.16%). String exotic objects (Â§10.4.3): wrapper .length and indexed character access with correct descriptors. Built-in method enumerability: bulk insert_valueâ†’insert_builtin for all prototype/static methods. Global NaN/Infinity/undefined made non-writable/non-configurable. `in` operator: symbol key support and TypeError for non-object RHS. Strict mode inheritance for nested functions/arrows. Sloppy this wrapping (ToObject for primitive this). from_property_descriptor always includes get/set for accessors. define_own_property checks array_elements for existing properties. Object: 3,076â†’3,121 (92%), Array: 2,306â†’2,342 (76%), String: 1,015â†’1,024 (84%).

37. ~~**Symbol.species accessor**~~ â€” âœ… Done (27 new passes, 64.64% â†’ 64.70%). Added `[Symbol.species]` getter to Array, ArrayBuffer, Map, Set, Promise, RegExp constructors. Simple getter returning `this`. All 29 direct tests now pass. See `plan/symbol-species.md`.

38. ~~**ArrayBuffer.prototype getters**~~ â€” âœ… Done (3 new passes, 64.70% â†’ 64.71%). Added `detached`, `resizable`, `maxByteLength` accessor properties to ArrayBuffer.prototype. For non-resizable buffers: detached=false, resizable=false, maxByteLength=byteLength. Most direct tests require `arraybuffer-transfer` or `resizable-arraybuffer` features not yet implemented. See `plan/arraybuffer-getters.md`.

39. ~~**GeneratorFunction constructor**~~ â€” âœ… Done (27 new passes, 64.71% â†’ 64.78%). Implemented GeneratorFunction constructor (Â§27.3) with proper prototype chain: GeneratorFunction.prototype inherits from Function.prototype, links to Generator.prototype. Fixed `create_function()` to assign `generator_function_prototype` to generator functions. Fixed `eval_new()` to reject generators and async functions as constructors. Fixed Generator.prototype.return/throw to validate generator state. GeneratorFunction: 7/23 â†’ 18/23 (78%), GeneratorPrototype: 41/61 â†’ 49/61 (80%).

40. ~~**AsyncFunction and AsyncGeneratorFunction constructors**~~ â€” âœ… Done (21 new passes, 64.78% â†’ 64.82%). Implemented AsyncFunction (Â§27.7) and AsyncGeneratorFunction (Â§27.4) constructors. Added `async_function_prototype` field to Interpreter with Symbol.toStringTag. AsyncFunction.prototype inherits from Function.prototype. Fixed `create_function()` to detect async non-generator functions and assign correct prototype/class_name. Constructors are intrinsics (not exposed as globals) - accessed via `Object.getPrototypeOf(async function(){}).constructor`. AsyncFunction: 10/18 â†’ 15/18 (83%), AsyncGeneratorFunction: 9/23 â†’ 19/23 (83%).

41. ~~**Rewrite assignment destructuring**~~ â€” âœ… Done (138 new passes, 64.82% â†’ 65.11%). Rewrote array and object assignment destructuring to use iterator protocol (`get_iterator`/`iterator_step`/`iterator_value`) instead of direct `array_elements` access. Added `put_value_to_target` for recursive dispatch to any assignment target (identifiers, member expressions, nested patterns). Added `set_member_property` helper for member expression targets (dot, computed, private, Proxy set traps, setters). Added `iterator_close_result` for proper IteratorClose error propagation. Object destructuring now uses `get_object_property` for getter/Proxy trap invocation, supports rest (`{...r} = obj`). assignment/dstr: 120/368 (33%) â†’ 252/368 (69%).

43. ~~**Conformance batch 9: Map methods, RegExp @@replace, JSON parse/stringify, ToPrimitive**~~ â€” âœ… Done (+254 new passes, 69.48% â†’ 70.01%). Map.prototype.getOrInsert/getOrInsertComputed (100% pass). RegExp[@@replace] rewritten to spec Â§22.2.5.8: RegExpExec, result coercion, GetSubstitution, AdvanceStringIndex (34% â†’ 77%). JSON.parse reviver with Proxy support, ES2025 source text context, lone surrogate escaping, proxy-aware stringify (70% â†’ 96%). ToPrimitive OrdinaryToPrimitive bug fix: error propagation and getter invocation via get_object_property (+77 bonus String passes). ToObject-before-ToPropertyKey ordering fix for computed member access. Map: 156â†’158/204 (77%), RegExp: 1,154â†’1,214/1,879 (65%), JSON: 115â†’159/165 (96%), String: 1,043â†’1,120/1,215 (92%).

44. ~~**Conformance batch 10: var scoping, Promise combinators, Proxy trap forwarding**~~ â€” âœ… Done (+137 new passes, 70.01% â†’ 70.29%). Fixed `var` binding in block statements to declare in var scope (function/global) instead of current block scope â€” affects `bind_pattern` and `exec_variable_declaration` in exec.rs (+51 passes). Promise combinators (all/allSettled/race/any) now use spec-compliant `Invoke(nextPromise, "then", ...)` instead of internal `promise_then` (+47 passes). Proxy trap forwarding for proxy-of-proxy chains: all 12 non-get traps now recurse through proxy-aware helpers instead of raw `JsObjectData` methods (+7 passes). Also fixed `Object.preventExtensions` to throw TypeError when trap returns false, and class static blocks to use function scope environments. Function: 375â†’397/509 (78%), Promise: 501â†’548/639 (86%), Proxy: 173â†’181/311 (58%).

45. ~~**Conformance batch 11: iterator protocol, DataView/ArrayBuffer prototype, function name inference**~~ â€” âœ… Done (+783 new passes, 70.29% â†’ 71.91%). Three orthogonal fixes: (1) Iterator protocol in `bind_pattern`: IteratorClose after array destructuring, `iterator_value()` now uses `get_object_property()` for getter invocation, elision error propagation, object rest pattern getter invocation (+~400 passes). (2) DataView/ArrayBuffer prototype chain: constructor `.prototype` now points to the real prototype object with methods installed, matching Map/Set pattern (+~160 passes, DataView: 52%, ArrayBuffer: 45%, TypedArray: 66%). (3) IsAnonymousFunctionDefinition check: added `is_anonymous_function_definition()` to guard `set_function_name()` calls â€” comma expressions, parenthesized expressions no longer incorrectly infer names (+~220 passes). Array: 2,395â†’2,496/3,079 (81%), Iterator: 303â†’316/510 (62%).

46. ~~**Conformance batch 12: Set methods, Iterator helpers, TypedArray internals**~~ â€” âœ… Done (+231 new passes, 71.91% â†’ 72.39%). Three orthogonal fixes: (1) Set new methods spec compliance: GetSetRecord with getter-aware property access, spec-compliant iterator protocol, correct observable operation ordering, iterator close on early termination, live iteration for mutation visibility. Set: 261â†’365/383 (95%). (2) Iterator helper method fixes: getter-aware iterator protocol throughout, GetIteratorFlattenable for flatMap, IteratorCloseAll with reverse ordering, zip/zipKeyed complete rewrite with spec-compliant mode/padding/strict handling, null-prototype result objects for zipKeyed, proper argument validation order for take/drop. Iterator: 316â†’436/510 (85%). (3) TypedArray internal methods: CanonicalNumericIndexString (Â§7.1.4.1), IsValidIntegerIndex (Â§10.4.5.14), TypedArray [[Get]]/[[Set]]/[[Delete]]/[[HasProperty]]/[[DefineOwnProperty]] per spec, ToNumber/ToBigInt coercion before index check, buffer-arg constructor to_index() fixes. TypedArrayConstructors: 405â†’498/736 (67%).

47. ~~**Conformance batch 13: delete-private early error, numeric separators, function .length**~~ â€” âœ… Done (+286 new passes, 72.39% â†’ 72.98%). Three orthogonal fixes: (1) Delete private name early error: `delete obj.#x` and `delete (obj.#x)` now produce SyntaxError per spec Static Semantics early error rules for UnaryExpression. Parser-only change in expressions.rs (+192 passes). (2) Numeric separator validation: reject invalid `_` placements in numeric literals â€” double underscores, trailing underscore, leading after prefix, adjacent to `.` or `e`/`E`. Lexer-only change (+25 passes). (3) Function `.length` stops counting at first default/rest parameter per Â§9.2.6 SetFunctionLength, and async non-generator functions no longer get `.prototype` property since they are not constructable (+69 passes).

48. ~~**Conformance batch 14: ThrowTypeError intrinsic, Uint8Array base64/hex, Math.f16round/sumPrecise**~~ â€” âœ… Done (+133 new passes, 72.98% â†’ 73.26%). Three orthogonal features: (1) %ThrowTypeError% intrinsic (Â§10.2.4): shared frozen function that throws TypeError, wired into strict arguments callee/caller accessors and Function.prototype.caller/arguments poison pills. Sloppy non-arrow/non-generator/non-async functions get own `caller`/`arguments` = null to shadow prototype accessor (Annex B). Method definitions strip these properties. ThrowTypeError: 6â†’13/14 (93%), Function: 397â†’432/509 (85%). (2) Uint8Array base64/hex methods (ES2025): fromBase64, fromHex, toBase64, toHex, setFromBase64, setFromHex with alphabet options, lastChunkHandling modes, whitespace stripping, proper error reporting. Uint8Array: 8â†’66/68 (97%). (3) Math.f16round (IEEE 754 binary16 conversion with manual bit manipulation) and Math.sumPrecise (BigInt exact arithmetic summation with iterator protocol). Math: 300â†’316/327 (97%).

49. ~~**Conformance batch 15: DataView Float16, class this TDZ, Object.__proto__ + Array fixes**~~ â€” âœ… Done (+338 new passes, 73.26% â†’ 73.96%). Three orthogonal features: (1) DataView getFloat16/setFloat16 (ES2025) and DataView setter coercion ordering fix â€” setters now perform ToNumber/ToBigInt on value BEFORE buffer detachment and bounds checks per spec. DataView: 293â†’454/561 (80%). (2) Derived constructor `this` TDZ enforcement â€” `this` is uninitialized until `super()` is called in derived class constructors, with proper new.target forwarding via `construct_with_new_target()`. Class `.prototype` property now writable:false per spec. (3) Object.prototype.__proto__ accessor (Annex B Â§B.2.2.1), Array.prototype[@@unscopables], and Symbol.isConcatSpreadable support in Array.prototype.concat. Object: 3,176â†’3,181/3,411 (93%), Array: 2,496â†’2,553/3,079 (82%), Promise: 548â†’571/639 (89%), Reflect: 124â†’132/153 (86%).

50. ~~**Conformance batch 16: Annex B block-level functions, RegExp fixes**~~ â€” âœ… Done (+363 new passes, 73.96% â†’ 74.71%). Two orthogonal features: (1) Annex B.3.3/B.3.4 block-level function declarations in sloppy mode: var-scope hoisting with copy-on-evaluation semantics, parameter/lexical conflict detection, generator/async exclusion, switch case function hoisting, IsLabelledFunction checks for iteration bodies and if-with-else. Parser: function declarations in if-bodies and labeled statements (sloppy mode only). annexB: 399â†’674/1,086 (62%). (2) RegExp fixes: pattern validation, type checks, `regexp_exec_abstract()` usage for spec-compliant exec dispatch. RegExp: 1,216â†’1,289/1,879 (69%).

51. ~~**Conformance batch 17: RegExp, Array, Date improvements**~~ â€” âœ… Done (+359 new passes, 74.71% â†’ 75.46%). Three orthogonal features implemented in parallel: (1) RegExp: removed own flag/source/flags data properties from RegExp instances (now prototype getters only), internal slots via `__original_source__`/`__original_flags__`, spec_set() helper, Symbol.match/search/split/matchAll rewrites, RegExp constructor IsRegExp check, escape_regexp_pattern(), pattern validation. RegExp: 1,289â†’1,389/1,879 (74%). (2) Array: coercion fixes (to_number_value/to_string_value), spec-compliant Set/Delete/HasProperty with throw variants, CreateDataPropertyOrThrow with extensibility checks, ArraySpeciesCreate with Proxy support, integer limit checks (2^53-1), toString fallback to %Object.prototype.toString%. Array: 2,553â†’2,711/3,079 (88%). (3) Date: removed primitive_value from Date.prototype, setter error propagation with to_number_value(), Symbol.toPrimitive rewrite (check Object not Date), toJSON rewrite per spec, constructor ToPrimitive hint="default". Date: 493â†’561/594 (94%). Integration fixes: String.prototype.replaceAll/matchAll now use Get(searchValue, "flags") and IsRegExp per spec, TypedArray.prototype.join separator coercion, array_elements sync for indexed property mutation.

52. ~~**Conformance batch 18: Number/Symbol coercion, constructor fix, RegExp patterns**~~ â€” âœ… Done (+71 new passes, 75.46% â†’ 75.60%). Three orthogonal fixes implemented in parallel: (1) Number/Symbol: Number prototype methods (toString, toFixed, toExponential, toPrecision) now use `to_number_value()` for argument coercion with proper ToPrimitive/Symbol TypeError. Argument coercion order fixed (coerce BEFORE NaN/Infinity check). `toFixed` returns ToString(x) for |x|>=10^21. `string_to_number` rejects case-insensitive "infinity". Symbol()/Symbol.for() use `to_string_value()` for description coercion. Number() constructor propagates ToPrimitive errors. Number: 331/335 (98%). (2) Constructor own property: removed spurious `constructor` own property set on every `new` object instance â€” `constructor` is now properly inherited from prototype chain only. Object: 3,181â†’3,184/3,411 (93%). (3) RegExp: quantifier-at-start validation (SyntaxError for `*`/`+`/`?`/`{}` at pattern start or after `(`/`|`), forward backreference handling (\N matches empty string when group not yet captured), octal escape handling for non-Unicode mode. RegExp: 1,389â†’1,432/1,879 (76%).

53. ~~**Real-world app integration: Acorn, Marked, Prettier**~~ â€” âœ… Done (+79 net new passes, 76.25% â†’ 76.42%).

55. ~~**Conformance batch 22: String, Iterator helpers, Proxy/native fn prototype**~~ â€” Done (+108 new passes, 76.64% â†’ 76.87%). Three orthogonal fixes: (1) String built-in fixes: getter-aware Symbol method lookups (match/replace/search/split), IsRegExp check, split ToUint32 limit, replaceAll upfront ToString, String.prototype as String wrapper object, matchAll fixes. String: 1,141â†’1,157/1,215 (95%). (2) Iterator helper fixes: re-entrancy detection via `running` flag, return method error propagation, take/drop argument validation with iterator close, concat.length=0, Iterator.from rewrite with WrapForValidIteratorPrototype, constructor/toStringTag as accessor properties. Iterator: 438â†’490/510 (96%). (3) Native function [[Prototype]] fix: `create_function()` uses `self.function_prototype` field directly, retroactive walk extended to cover internal prototype fields (iterator/collection/generator protos), generator/async function prototypes unconditionally fixed, Error.prototype.toString throws TypeError for non-object `this`. Function: 433â†’446/509 (88%), Proxy: 231â†’245/311 (79%), Object: 3,184â†’3,216/3,411 (94%), Set: 365â†’372/383 (97%).

57. ~~**Dynamic import from scripts fix**~~ â€” âœ… Done (+203 new passes, 76.89% â†’ 77.31%). Two fixes: (1) jsse: `run_with_path()` now sets `current_module_path` for scripts (not just modules), enabling `import()` to resolve relative specifiers from script files. (2) Test runner: temp files for non-module tests now written in the same directory as the original test file (not `/tmp/`), so FIXTURE module files resolve correctly.

56. ~~**Conformance batch 23: Async generator yield* delegation, class method constructability**~~ â€” âœ… Done (+11 new passes, 76.87% â†’ 76.89%). Two fixes: (1) Async generator yield* delegation: continuation path now awaits iterator result before extracting done/value (matching initial setup path), return/throw forwarding to inner iterator during yield* delegation, IteratorValue error propagation into generator try/catch via catch state jump. (2) Class method constructability: added `is_method` flag to `JsFunction::User`, class methods marked non-constructable (no `.prototype`, TypeError on `new`), generator/async-generator methods retain `.prototype` for generator prototype chain, `is_constructor` check updated in eval_new/create_function/promise.rs.

54. ~~**Conformance batch 21: Reflect, CanBeHeldWeakly, Proxy has+with**~~ â€” âœ… Done (+109 new passes, 76.42% â†’ 76.64%). Three orthogonal features implemented in parallel: (1) Reflect built-in fixes: Reflect[Symbol.toStringTag], setPrototypeOf returns false (not throws) per spec Â§9.1.2, ownKeys property ordering (integer indices â†’ strings â†’ symbols per Â§9.1.12), Reflect.has.length=2, ToPropertyKey error propagation, CreateListFromArrayLike validation in apply/construct, Reflect.set accessor with receiver. Reflect: 132â†’153/153 (100%). (2) CanBeHeldWeakly + WeakRef/FinalizationRegistry: implemented CanBeHeldWeakly (Â§7.2.7) â€” objects and unregistered symbols can be held weakly, registered symbols and primitives cannot. Applied to WeakRef constructor, WeakMap.set, WeakSet.add, FinalizationRegistry register/unregister. Symbol tokens in FinalizationRegistry. OrdinaryCreateFromConstructor for NewTarget prototype. WeakRef: 24â†’28/29 (97%), FinalizationRegistry: 36â†’46/47 (98%). (3) Proxy `has` trap in `with` statement: Object Environment Record HasBinding now uses proxy-aware [[HasProperty]] for with-scope lookups. GetBindingValue uses get_object_property for proxy get trap. Proxy/has: 17â†’24/26 (92%), with: 121â†’124/181 (69%). Real-world JavaScript apps (Acorn parser, Marked markdown, Prettier formatter) exposed engine bugs fixed in feat/realapp branch. Key fixes: (1) Parser: `async`/`of` as contextual identifiers, `true`/`false`/`null` as dot member property names and object property keys, optional chaining continuation (`.prop`, `[expr]`, `()` after `?.`). (2) Array: GC rooting for intermediate arrays in concat/slice/map/filter/splice. (3) GC: module environment and promise data tracing, call stack environment rooting in exec_statements, private field definition tracing. (4) Eval: private field access on class instances, computed member access improvements. Post-merge fixes: array index bounds check (indices â‰¥ 2^32-1 are not valid array indices, density check for sparse arrays), exponentiation spec compliance (Â±1 ** Â±âˆž = NaN per Â§6.1.6.1.4), reserved word shorthand rejection (`({false})` is SyntaxError), RegExp `\d`/`\D`/`\w`/`\W` translated to ASCII-only character classes per spec. Note: 37 RegExp property-escape tests that were passing vacuously (broken buildString returned empty arrays) now correctly fail due to regex crate Unicode data version mismatch. Array: 2,711â†’2,734/3,079 (89%), RegExp: 1,432â†’1,398/1,879 (74%, -34 from vacuous property-escape fixes).

58. ~~**Conformance batch 24: TypedArray species, BigInt coercion, set() rewrite**~~ â€” âœ… Done (+189 new passes, 86.56% â†’ 86.95%). TypedArray method completion: (1) TypedArraySpeciesCreate (Â§23.2.4.1): helper method using SpeciesConstructor + ContentType validation. Updated slice/map/filter to use species create, subarray to use SpeciesConstructor with buffer args. TypedArrayCreateSameType helper for toReversed/toSorted/with. (2) BigInt coercion: typed_array_coerce_value() delegates to to_number_value/to_bigint_value based on kind. Fixed fill(), set(), from(), of(), and constructor iterable/array-like/TypedArray-copy paths. ContentType compatibility check in constructor TypedArray-copy path. (3) set() rewrite: offset coercion via to_number_value() BEFORE detach check, array-like source uses per-element typed_array_coerce_value(), TypedArray-arg same-buffer overlap handling via Rc::ptr_eq + data cloning. TypedArray: 962â†’1,119/1,438 (77.8%), TypedArrayConstructors: 512â†’543/736 (73.8%).

59. ~~**Conformance batch 25: AllPrivateNamesValid, assignment order, logical assignment write-back**~~ â€” âœ… Done (+276 new passes, 86.95% â†’ 87.52%). Three orthogonal fixes: (1) AllPrivateNamesValid parser early error (Â§15.7.1): `this.#x` in a class body where `#x` is never declared is now SyntaxError at parse time. Added `private_name_scopes` to parser with push/pop/declare/use helpers, nested class scope validation, `#constructor` prohibition, `super.#x` prohibition, eval private name context propagation via Environment chain (+99 passes). (2) Assignment evaluation order for member expressions: `eval_assign()` restructured so member expressions evaluate base â†’ key â†’ RHS per spec instead of RHS-first. Null/undefined base now throws TypeError. Compound assignment does ToPropertyKey+GetValue before RHS (+28 passes). (3) Logical assignment (`&&=`/`||=`/`??=`) member expression write-back: new `eval_logical_assign()` handles Identifier, dot/computed member, and private member targets with full property write logic including Proxy/setter/prototype chain support (+27 passes). Additional passes from interaction effects (+122).

60. ~~**Iterator protocol getter-awareness**~~ â€” âœ… Done (+134 new passes, 2 regressions, 90.61% â†’ 90.76%). Fixed 7 iterator protocol methods to use getter-aware `get_object_property()` instead of raw `get_property()`: get_iterator, get_async_iterator, iterator_next, iterator_next_with_value, iterator_return, iterator_throw, iterator_close. Fixed yield* eval path to use iterator_complete/iterator_value. 2 regressions are IsHTMLDDA tests that were passing vacuously (engine doesn't implement $262.IsHTMLDDA).

61. ~~**Resizable ArrayBuffer support**~~ â€” âœ… Done (+471 new passes, 90.76% â†’ 91.27%). Full implementation of resizable ArrayBuffers (Â§25.1.2) and growable SharedArrayBuffers per ES2024 spec. ArrayBuffer constructor accepts `maxByteLength` option, `resize()` method, `transfer()`/`transferToFixedLength()` methods. TypedArray/DataView updated with auto-length tracking, bounds checking against buffer byte length, and `byteLength`/`length` getter changes for out-of-bounds detection. ArrayBuffer: 52â†’100/136 (74%), TypedArray: 1,119â†’1,347/1,438 (94%), DataView: 454â†’614/561â†’622 (varies).

62. ~~**Class element test262 improvements**~~ â€” âœ… Done (+410 new passes, 91.27% â†’ 91.71%). Eight class-related fixes: (1) Private name branding per class evaluation â€” unique brands per class instantiation prevent cross-instance private member access. (2) eval + new.target in field initializers â€” `set_eval_in_field_initializer()` now increments `in_function` so `new.target` is valid syntax in eval within field initializers. (3) Field extensibility + proxy observation â€” `create_data_property_or_throw()` used for public field init, extensibility check for private fields. (4) Static block parsing restrictions â€” `return`/`yield`/`arguments` forbidden, `await` reserved, `new.target` allowed. (5) Static field "prototype" restriction â€” computed static field key evaluating to "prototype" throws TypeError. (6) Default parameter self-reference TDZ â€” `method(x = x)` throws ReferenceError. (7) Escaped keyword detection â€” `\u0061sync` no longer treated as `async`. (8) Async generator yield* delegation improvements â€” cached `next_method` in DelegatedIteratorInfo, getter-aware return/throw in async-from-sync wrapper, null `[Symbol.asyncIterator]` handling, absent-value semantics for wrapper next(). Class: 16,350/16,689 (97.97%).

63. ~~**Tier 1: Closing the test262 gap**~~ â€” âœ… Done (+364 net new passes, 91.94% â†’ 92.33%). Six implemented tasks: (1) BigInt.asIntN/asUintN parameter coercion â€” ToIndex for bits, ToBigInt for bigint (+32 passes). (2) Dynamic import toString rejection â€” ToString(specifier) errors produce rejected promise via IfAbruptRejectPromise (+32 passes). (3) Module namespace exotic object handlers â€” [[Set]] always false, [[Delete]] false for exports, [[DefineOwnProperty]] identical-descriptor check, getter-aware [[GetOwnProperty]] (+10 passes). (4) import() second argument â€” parser accepts optional options expression, abrupt completions propagate synchronously (+23 passes). (5) Array.fromAsync â€” full implementation with async/sync iterator and array-like paths (+141 passes). (6) Import-defer syntax â€” `import defer * as ns` parsing with `DeferredNamespace` AST variant, eager evaluation fallback (+3 passes). Two tasks skipped: RegExp named groups duplicate-names and lookBehind captures need `fancy-regex` engine changes.

64. ~~**RegExp lookBehind + dotAll unicode fix**~~ â€” âœ… Done (+22 new passes, 93.82% â†’ 93.84%). Four phases: (1) Upgraded fancy-regex 0.14â†’0.17 for variable-length lookbehind support. (2) Fixed self-referential backreferences inside capturing groups. (3) Fixed lookbehind direction for repeated captures (`(?<=(\w){3})` rewrite). (4) Custom RTL lookbehind matcher in `regexp_lookbehind.rs` for patterns with backrefs/nested lookaround inside variable-length lookbehinds â€” strip-match-verify-merge architecture with position-iteration for external backrefs. Also fixed dotAll unicode mode to include lone surrogates. lookBehind: 10/34 â†’ 34/34 (100%). dotAll: 4/8 â†’ 8/8 (100%).

65. ~~**SharedArrayBuffer + Atomics implementation**~~ â€” âœ… Done (+868 new passes, 93.84% â†’ 94.78%). Full implementation of SharedArrayBuffer (Â§25.2) and Atomics namespace (Â§25.4). SharedArrayBuffer: constructor with `maxByteLength` option, prototype methods (byteLength, maxByteLength, growable, grow, slice), @@species, @@toStringTag. `arraybuffer_is_shared` flag on JsObjectData, `shared_arraybuffer_prototype` on Interpreter with GC root. detach_arraybuffer throws TypeError for SABs. Atomics: 14 methods â€” add/sub/and/or/xor/exchange (read-modify-write), load, store (with ToIntegerOrInfinity return), compareExchange (bytewise comparison), isLockFree, wait (throws TypeError, [[CanBlock]]=false), notify (returns 0), waitAsync (synchronous not-equal/timed-out paths), pause (strict type checking). ValidateIntegerTypedArray and ValidateAtomicAccess helpers with proper spec-compliant error ordering. Single-threaded engine: $262.agent tests not implementable. SharedArrayBuffer: 180/208 (87%), Atomics: 492/764 (64%), TypedArrayConstructors: +102 bonus passes.

66. ~~**Array exotic [[DefineOwnProperty]] + ArraySetLength**~~ â€” âœ… Done (+116 new passes, 94.84% â†’ 94.96%). Implemented spec-compliant Array exotic [[DefineOwnProperty]] (Â§10.4.2.1) and ArraySetLength (Â§10.4.2.4) as centralized methods on Interpreter. Refactored Object.defineProperty to use these methods (removing ~120 lines of inline Array logic). Updated Object.defineProperties to route Array targets through array_define_own_property(). Fixed set_property_value writable check for Array length. Object/defineProperty: 2250/2250 (100%), Object/defineProperties: 1262/1264 (99.84%), Object: 6,565/6,802 (97%), Array: 5,846/6,111 (96%).

67. ~~**RegExp compliance fixes**~~ â€” âœ… Done (+160 new passes, 94.96% â†’ 95.12%). Eight fixes across lexer, validator, translator, and parser: (1) LS/PS rejection in regex literals â€” lexer now rejects U+2028/U+2029 as line terminators (+42 passes). (2) `/u` flag escape validation â€” incomplete `\x`/`\u`/`\c` escapes, bare `{`/`}`, identity escape restrictions, char class range validation (+104 passes). (3) Quantifiers on assertions â€” reject `*`/`+`/`?`/`{n}` after lookahead/lookbehind in `/u` mode and lookbehinds always (+26 passes). (4) Named group ZWNJ/ZWJ â€” sanitize non-ASCII group names for Rust regex crate, decode `\uXXXX` escapes in group names (+14 passes). (5) Duplicate group capture clearing â€” conditional backreferences via `fancy-regex` `(?(group)...)` syntax (+2 passes). (6) Non-Unicode case folding â€” guard problematic chars (long-s, Kelvin sign, etc.) with `(?-i:...)` (+4 passes). (7) Forward/undefined backreferences â€” emit empty match for forward refs, conditionals for backward refs (+50 passes). (8) ASI after regex re-lex â€” parser now tracks line terminators during regex re-lexing (+6 passes). RegExp: 3,481â†’3,674/3,756 (98%), language/literals/regexp: 378â†’470/476 (99%), annexB/built-ins/RegExp: 108â†’110/124 (89%).

68. ~~**Conformance batch: TypedArray, import, destructuring, for-of**~~ â€” âœ… Done (+340 new passes, 95.13% â†’ 95.49%). Ten fixes across three areas: (1) TypedArray: spec-correct modular integer conversion (to_int32/to_uint32 etc. use wrapping instead of saturation), [[HasProperty]] canonical numeric index check, [[Delete]] strict mode TypeError, [[OwnPropertyKeys]] virtual index synthesis. TypedArrayConstructors: 1,228â†’1,256/1,442 (87%). (2) Dynamic import: import.defer()/import.source() parsing and runtime, import() options validation (TypeError for non-object), module this=undefined. dynamic-import/catch: 202â†’266/336 (79%). (3) Destructuring/iteration: compound assignment null/undefined base evaluation order, destructuring pattern validation (rest-before-element, multiple rest, rest-with-initializer), for-of TDZ in head expression. assignment: 747â†’759/850 (89%), compound-assignment: 720â†’764/786 (97%), for-of: 1,332â†’1,344/1,442 (93%).

69. ~~**`using`/`await-using` (Explicit Resource Management) bug fixes**~~ â€” âœ… Done (+58 new passes, 95.99% â†’ 96.05%). Five targeted bug fixes: (1) Parser: `parse_try_statement` now sets `in_block_or_function=true` for try/catch/finally bodies so `using` declarations are recognized inside try blocks. (2) `add_disposable_resource`: replaced raw `get_property` with getter-aware `get_object_property` for `Symbol.dispose` lookup â€” fixes objects with `get [Symbol.dispose]()` accessors. (3) `exec_for`: restructured with Rust labeled block to call `dispose_resources` after all loop exit paths (break/normal/throw). (4) `call_function`: added `dispose_resources` call after `exec_statements` for sync function body disposal. (5) `call_async_function`: added `dispose_resources` call after `exec_statements` for async function body disposal. Parser: `for (using x = init; test; update)` regular for loop support, `for (await using x = init; test; update)` support, `is_using_declaration()` extended to recognize `await`/`yield`/`let`/`static`/`async` keyword tokens. Class static blocks: set `in_block_or_function=true`. `check_for_in_of_early_errors` extended to reject `let` binding in `using`/`await-using` declarations. using/await-using: 246â†’300/336 (89.3%).

70. ~~**Array holes / sparse array prototype chain traversal**~~ â€” âœ… Done (+126 new passes, 96.05% â†’ 96.19%). Four targeted fixes to correctly handle JavaScript "holes" in sparse arrays (created via `[0,,2]` literals or `delete arr[i]`). Root cause: `array_elements: Vec<JsValue>` stored holes and actual `undefined` values indistinguishably as `JsValue::Undefined`, causing holes to not fall through to the prototype chain. Fix strategy: since `set_property_value` always writes to both `properties` and `array_elements`, a `JsValue::Undefined` in `array_elements` WITHOUT a corresponding `properties` entry is always a hole. Changes: (1) `get_property` â€” skip `array_elements` hit when value is `Undefined` (let prototype chain handle it); (2) `get_property_descriptor` â€” same hole skip; (3) `get_own_property_full` â€” same hole skip (returns `None` for holes, not a descriptor); (4) delete operator (`eval.rs`) â€” after removing from `properties`, also set `array_elements[idx] = JsValue::Undefined` to clear the old cached value. Tests fixed: `[0,,2][1]` â†’ prototype lookup, `delete arr[i]` â†’ hole â†’ prototype lookup, `hasOwnProperty(hole)` â†’ false, `key in hole` â†’ false, `for..in` skips holes, `Object.keys` omits holes, array methods (`map`/`forEach`/`filter`) skip holes. Array.prototype: improved pass rate.

71. ~~**IteratorClose in array destructuring assignment**~~ â€” âœ… Done (+102 new passes, 96.19% â†’ 96.30%). Two spec compliance fixes for `Â§13.15.5.2` IteratorClose in array destructuring assignment. Bug 1 (LHS eval order, thrw-close/lref-err): Per spec, `AssignmentElement` step 1 evaluates the LHS ref BEFORE stepping the iterator. Old code stepped the iterator first, so when LHS throws during evaluation, `done=true` and IteratorClose was skipped. Fix: added `eval_member_lhs_ref` helper that pre-evaluates member expression base+key before iterator steps; extracted `set_object_with_key` from `set_member_property` to allow split evaluate-then-assign. Bug 2 (rtrn-close, generators): When a generator yields mid-destructuring (via `InlineYield`) with `done=false`, calling `generator.return()` must call `IteratorClose` on the open iterator. Fix: added `pending_iter_close: Vec<JsValue>` field to track open iterators when yielding, saved to `generator_inline_iters: HashMap<u64, Vec<JsValue>>` (keyed by generator object ID) in `generator_next_state_machine` InlineYield path, and closed those iterators in `generator_return_state_machine`. Also fixed a Rust temporary borrow bug: `env.borrow().strict` in function-call argument position keeps the borrow alive for the call's duration; fixed by extracting to a `let strict = env.borrow().strict` binding first. assignment/dstr: 545â†’595/640 (93%).

72. ~~**TypedArray `__buffer__` cleanup**~~ â€” âœ… Done (+20 new passes, 96.30% â†’ 96.32%). TypedArray and DataView objects were storing their backing ArrayBuffer JS object as a regular (non-enumerable) property named `__buffer__` in `property_order`/`properties`. While `Object.keys` and `for-in` correctly excluded it, `Object.getOwnPropertyNames`, `Reflect.ownKeys`, `Object.getOwnPropertyDescriptor`, and `hasOwnProperty` incorrectly exposed it, violating the spec's `[[GetOwnProperty]]` and `[[OwnPropertyKeys]]` for TypedArrays. Fix: added `view_buffer_object_id: Option<u64>` field to `JsObjectData` to store the ArrayBuffer object ID without touching `property_order` or `properties`. Updated GC tracing in `gc.rs` to mark `view_buffer_object_id` as a root. Replaced all 5 `insert_property("__buffer__", ...)` sites (TypedArray constructor, `create_typed_array_object`, `create_typed_array_object_with_proto`, TypedArraySpeciesCreate, DataView constructor) and all 4 `get_property("__buffer__")` readers (TypedArray `.buffer` getter, `subarray`, DataView `.buffer` getter, Atomics shared-buffer check) with direct field access. TypedArray: 2,732/2,860 (95.5%).

73. ~~**TypedArray RAB compliance + Proxy key type + Symbol+string TypeError**~~ â€” âœ… Done (+701 net new passes from 88,722 baseline, 96.32% â†’ 96.37%). Four interrelated fixes: (1) TypedArray RAB full compliance: sort write-back OOB check (`is_valid_integer_index` before each element write), TypedArray iterator OOB throws TypeError instead of returning done=true, set() captures `target_len` before source length getter, set() uses `is_valid_integer_index` for mid-iteration writes, `typed_array_create` helper for spec-order `of`/`from` (construct first with len, then Set elements), `collect_iterable_or_arraylike` error propagation, generic constructor path in `construct_typed_array_from_this`. TypedArray: 2,858â†’2,864/2,864 (100.00%). (2) Proxy trap key type: `get_object_property`, `proxy_has_property`, `proxy_set`, `proxy_delete_property`, `proxy_define_own_property`, `proxy_get_own_property_descriptor` were passing property key to traps as a plain String even for Symbol keys. Fixed by using `symbol_key_to_jsvalue(key)` which reconstructs the actual JsValue::Symbol for well-known and user symbols. Proxy: 540â†’544/607 (89.6%). (3) Symbol implicit coercion TypeError: `BinaryOp::Add` was silently converting Symbols to their string representation (e.g. "Symbol(Symbol.iterator)") instead of throwing TypeError. Fixed by checking for Symbol operands before string concatenation. These are connected: test262's `throwingProxy` `get` trap throws `new Error('Called getter for ' + prop)` where `prop` is a Symbol key â€” fix (2) ensures `prop` is a Symbol, fix (3) ensures `string + Symbol` throws TypeError (not Error), which is why the test expects TypeError from `assert.throws(TypeError, () => SetNumOrBigInt(OOB_typed_array, throwingProxy))`. Files: `src/interpreter/eval.rs` (BinaryOp::Add Symbol check, all 5 proxy trap key fixes), `src/interpreter/builtins/typedarray.rs` (RAB fixes), `src/interpreter/builtins/iterators.rs` (OOB TypeError).

76. ~~**Math/Number built-in fixes + DisposableStack/AsyncDisposableStack spec compliance**~~ â€” âœ… Done (+72 new passes in targeted areas, 0 regressions). Two orthogonal areas: (1) Math/Number: Math.hypot two-pass coercion (infinity before NaN), Math.max/min signed-zero ordering and error propagation via `to_number_value()`, Math.pow NaN-exponent and Â±1**Â±âˆž cases via `exponentiate()`, Math.round spec-correct edge cases (-0 for x in [-0.5,0), integer shortcut for large values). Number.toExponential: undefined fractionDigits uses shortest representation, round-half-up via high-precision digit extraction (avoids Rust's banker's rounding). Number.toPrecision: precision loss fix using full IEEE 754 digit extraction. Math: 632â†’654/654 (100%), Number: 662â†’668/670 (99.7%). (2) DisposableStack/AsyncDisposableStack: `disposed` getter enumerable:false; constructors check new.target and use `OrdinaryCreateFromConstructor` via `get_prototype_from_new_target()`; `prototype` property is writable:false/enumerable:false/configurable:false; `use()`/`move()`/`dispose()` check `class_name` to distinguish `DisposableStack` vs `AsyncDisposableStack`; `use()` now calls `get_object_property()` to invoke `Symbol.dispose` getters; AsyncDisposableStack `move()` also gets class_name check. `SuppressedError` constructor restructured to use `OrdinaryCreateFromConstructor`. Added `Realm::new()` fields for `disposable_stack_prototype`, `async_disposable_stack_prototype`, `suppressed_error_prototype`. DisposableStack: 162â†’180/182 (98.9%), AsyncDisposableStack: 98â†’102/104 (98.1%).

74. ~~**Class instance field initialization fixes**~~ â€” âœ… Done (+32 new passes, 96.32% â†’ 96.36%). Three spec compliance fixes for class field initialization (Â§15.7.14 `InitializeInstanceElements`): (1) `construct_with_new_target` base path did not initialize instance fields â€” when `class B extends A` calls `super()`, the base path of `construct_with_new_target` constructed the object and executed A's constructor body but never ran A's instance field initializers. Fix: added field initialization loop (same two-pass pattern as `eval_new`) before `call_function` in the base path. (2) Separate private/public field lists caused wrong initialization order â€” previously `class_private_field_defs` and `class_public_field_defs` were stored as separate `Vec`s, so all private fields were always initialized before all public fields regardless of source order. Fix: replaced both lists with a single `class_instance_field_defs: Vec<InstanceFieldDef>` (new `InstanceFieldDef` enum with `Private(PrivateFieldDef)` and `Public(String, Option<Expression>)` variants) built in `eval_class_inner` in source declaration order. Updated GC tracing in `gc.rs` to trace `Method`/`Accessor` values within the unified list. (3) Private methods must be installed before any field initializer runs per Â§15.7.14 step 4 (install methods/accessors) vs step 5 (run field initializers). Fix: changed single-pass iteration to two-pass in `initialize_instance_elements`, `eval_new` base path, and `construct_with_new_target` base path â€” pass 1 installs all `PrivateFieldDef::Method` and `PrivateFieldDef::Accessor` entries, pass 2 runs field initializers in source order. Files changed: `src/interpreter/types.rs` (new enum, unified field), `src/interpreter/gc.rs` (updated tracing), `src/interpreter/eval.rs` (three call sites updated + new initialization in `construct_with_new_target`). Class tests: 177 failures â†’ 145 failures.

---

## Cross-Cutting Concerns

These are tracked across all phases:

- [x] **Strict mode** â€” enforce throughout parser and runtime
- [x] **Unicode** â€” full Unicode support in lexer, identifiers, strings
- [x] **Unicode RegExp property escapes** â€” Generated Unicode 17.0.0 tables, expand `\p{...}`/`\P{...}` inline (+292 passes, 88.34% â†’ 88.52%). RegExp property-escapes: 722â†’1,012/1,074 (94.23%).
- [x] **RegExp modifiers + dotAll** â€” Modifier syntax validation (`(?i:...)`, `(?s-m:...)`), dot line terminator fix (`.` no longer matches `\r`/`\u2028`/`\u2029`), modifier dotAll handling (+154 passes). RegExp: 3,240/3,892 (83.2%).
- [x] **Unicode RegExp v flag** â€” `v` flag (unicodeSets) support: parser, set operations, character class parsing, `\p{...}` string properties
- [ ] **Error reporting** â€” quality error messages with source locations
- [ ] **Spec compliance annotations** â€” link code to spec section IDs
- [x] **Garbage collection** â€” mark-and-sweep GC with ephemeron support for WeakMap/WeakSet
- [ ] **Performance** â€” profile and optimize hot paths after correctness
- [x] **Annex B (partial)** â€” String HTML methods, substr, escape/unescape, Date getYear/setYear/toGMTString (+117 passes), block-level function declarations B.3.3/B.3.4 (+275 passes), eval block-level function hoisting B.3.3.3 (+163 passes)

---

## Test262 Integration

- Test harness: Rust binary that runs test262 `.js` files against our engine
- Harness files: `test262/harness/*.js` must be pre-loaded (assert.js, sta.js, etc.)
- Metadata parsing: each test has YAML frontmatter with flags, features, negative expectations
- Progress tracking: after each implementation session, run suite and update this file

### Test262 Breakdown by Area

| Area | Tests | Notes |
|------|-------|-------|
| `language/expressions` | 21,161 (19,987 pass) | Largest language category |
| `language/statements` | 9,337 | Second largest |
| `language/module-code` | 737 | |
| `language/literals` | 534 | |
| `language/eval-code` | 347 (315/454 pass, 69.38%) | +33 from eval-code compliance |
| `language/identifiers` | 268 | |
| `language/arguments-object` | 263 | |
| `language/function-code` | 217 | |
| `language/import` | 162 | |
| `language/block-scope` | 145 | |
| `language/types` | 113 | |
| `language/asi` | 102 | |
| `language/` (other) | ~400 | white-space, comments, keywords, etc. |
| `built-ins/Temporal` | 8,964 | 8,898 (99.3%) |
| `built-ins/Object` | 6,802 | 6,565 (96.5%) |
| `built-ins/Array` | 6,111 | 5,874 (96.1%) |
| `built-ins/RegExp` | 3,756 | 3,682 (98.0%) |
| `built-ins/TypedArray` | 2,864 | 2,864 (100.0%) |
| `built-ins/TypedArrayConstructors` | 1,442 | 1,280 (88.8%) |
| `built-ins/String` | 2,427 | 2,362 (97.3%) |
| `built-ins/DataView` | 1,122 | 1,090 (97.1%) |
| `built-ins/Proxy` | 607 | 544 (89.6%) |
| `built-ins/` (rest) | ~16,000+ | All other built-ins |
| `annexB` | 1,377 | 1,264 (91.8%) |
| `intl402/Temporal` | 3,838 | 3,838 (100.00%) |
| `intl402` | varies | Internationalization â€” optional |

---

## Milestone Targets

| Milestone | Description | Target Tests | Status |
|-----------|-------------|--------------|--------|
| M0 | CLI runs, exits with code | 0 | âœ… |
| M1 | Numeric/string/bool literals evaluate | ~50 | âœ… |
| M2 | Variable declarations + basic expressions | ~500 | âœ… |
| M3 | Control flow (if/while/for) | ~1,500 | âœ… |
| M4 | Functions (basic call/return) | ~3,000 | âœ… |
| M5 | Objects + prototypes | ~6,000 | âœ… |
| M6 | All expressions + statements | ~15,000 | ðŸŸ¡ ~12,000 |
| M7 | Built-in objects (Object, Array, String, Number, Math, JSON) | ~25,000 | ðŸŸ¡ ~16,828 |
| M8 | Classes, iterators, generators, async/await | ~65,000 | âœ… ~70,000 |
| M9 | RegExp, Proxy, Reflect, Promise, modules | ~85,000 | âœ… 89,423 |
| M10 | Full spec compliance | ~92,788 | â¬œ |
